# 第五章 自动化扫描

> 作者：Gilberto Najera-Gutierrez

> 译者：[飞龙](https://github.com/)

> 协议：[CC BY-NC-SA 4.0](http://creativecommons.org/licenses/by-nc-sa/4.0/)

## 简介

几乎每个渗透测试项目都需要遵循严格的日程，多数有客户的需求或开发交谈日期决定。对于渗透测试者，拥有可以在很短的时间内执行单个应用上的多个测试，来尽可能在排期内识别最多漏洞的工具很有帮助。自动化漏洞扫描器就是完成这种任务的工具，它们也用于发现替代的利用，或者确保身肉测试中不会遗漏了明显的事情。

Kali 包含一些针对 Web 应用或特定 Web 漏洞的漏洞扫描器。这一章中，我们会涉及到一些在渗透测试者和安全研究员中最广泛使用工具。

## 5.1 使用 Nikto 扫描

每个测试者的工具库中必定含有的工具就是 Nikto，它可能是世界上使用最广泛的自由扫描器。就像它的网站（<https://cirt.net/Nikto2>）上所说的那样：

> Nikto 是开源（GPL）的 Web 服务器扫描器，它对 Web 服务器执行综合扫描，包含超过 6700 个潜在的危险文件或程序，检查超过 1250 个服务器的过期版本，以及超过 270 个服务器上的特定问题。它也会检查服务器配置项，例如多个首页文件的存在，HTTP 服务器选项，也会尝试识别安装的 Web 服务器和软件。扫描的项目和插件也会经常更新，并可以自动更新。

这个秘籍中，我们会使用 Nikto 来搜索 Web 服务器中的漏洞并分析结果、

### 操作步骤

1.  Nikto 是个命令行工具，所以我们打开终端。

2.  我们会扫描 Peruggia 漏洞应用，并导出结果到 HTML 报告：

    ```
    nikto -h http://192.168.56.102/peruggia/ -o result.html
    ```
    
    ![](img/5-1-1.jpg)
    
    `-h`选项告诉 Nikto 扫描哪个主机，`-o`选项告诉在哪里存放输出，文件的扩展名决定了接受的格式。这里，我们使用`.html`来获得 HTML 格式的结果报告。输出也可以以 CSV、TXT 或 XML 格式。
    
3.  它需要一些时间来完成扫描。完成之后，我么可以打开`result.html`文件：

    ![](img/5-1-2.jpg)
    
### 工作原理

这个秘籍中，我们使用 Nikto 来扫描应用并生成 HTML 报告。这个工具拥有一些更多的选项，用于执行特定扫描或生成特定输出格式。一些最实用的选项是：

+   `-H`：这会显示 Nikto 的帮助。

+   `-config <file>`：在扫描中用自定义的配置文件。

+   `-update`：更新插件数据库。

+   `-Format <format>`：这定义了输出格式，可以为CSV、HTML、NBE（Nessus）、SQL、TXT 或 XML。例如 CSV、XML 和 NBE 的格式在我们打算将其用于其它工具的输入时非常实用。

+   `-evasion <techique>`：这使用一些编码技巧来帮助避免 Web 应用防火墙和入侵检测系统的检测。

+   `-list-plugins`：查看可用的测试插件。

+   `-Plugins <plugins>`：选择在扫描中使用哪个插件（默认为全部）。

+   `-port <port number>`：如果服务器使用非标准端口（80，443），我们可能会以这个选项来使用 Nikto。

## 5.2 使用 Wapiti 发现漏洞

Wapiti 是另一个基于终端的 Web 漏洞扫描器，它发送 GET 和 POST 请求给目标站点，来寻找下列漏洞（<http://wapiti. sourceforge.net/>）：

+   文件泄露

+   数据库注入

+   XSS

+   命令执行检测

+   CRLF 注入

+   XXE（XML 外部实体）注入

+   已知潜在危险文件的使用

+   可被绕过的`.htaccess `弱配置

+   提供敏感信息的备份文件（源码泄露）

这个秘籍中，我们使用 Wapiti 来发现我们的测试应用上的漏洞，并生成扫描报告。

### 操作步骤

1.  我们可以从终端窗口打开 Wapiti，例如：

    ```
    wapiti http://192.168.56.102/peruggia/ -o wapiti_result -f html -m "-blindsql"
    ```
    
    我们会扫描 vulnerable_vm 中的 Peruggia 应用，将输出保存为 HTML 格式，保存到` wapiti_result`目录中，并跳过 SQL 盲注检测。
    
2.  如果我们打开了报告目录，和`index.html`文件，我们会看到一些这样的东西：

    ![](img/5-2-1.jpg)

    这里，我们可以看到 Wapiti 发现了 12 个 XSS 和 20 个文件处理漏洞。
    
3.  现在点击` Cross Site Scripting`（跨站脚本）。

4.  选项某个漏洞并点击`HTTP Request`。我们选择第二个，选中并复制请求的 URL 部分。

    ![](img/5-2-2.jpg)
    
5.  现在，我们将 URL 粘贴到浏览器中，像这样：`http://192.168.56.102/ peruggia/index.php?action=comment&pic_id=%3E%3C%2Fform%3E%3Cscr ipt%3Ealert%28%27wxs0lvms89%27%29%3C%2Fscript%3E`。

    ![](img/5-2-3.jpg)
    
    我们确实发现了 XSS 漏洞。
    
### 工作原理

这个秘籍中，我们跳过了 SQL 盲注检测（`-m "-blindsql"`），因为这个应用存在这个漏洞。它会触发超时错误，使 Wapiti 在扫描完成之前关闭，因为 Wapiti 通过输入 `sleep()`命令来测试多次，直到服务器超过了超时门槛。同时，我们为输出选择了 HTML 格式（`-o html`），`wapiti_result`作为报告的目标目录，我们也可以选择其他格式，例如，JSON、OpenVAS、TXT 或 XML。

Wapiti 拥有一些其它的有趣的选项，它们是：

+   `-x <URL>`：从扫描中排除特定的 URL，对于登出和密码修改 URL 很实用。

+   `-i <file>`：从 XML 文件中恢复之前保存的扫描。文件名称是可选的，因为如果忽略的话 Wapiti 从`scan`文件夹中读取文件。

+   `-a <login%password>`：为 HTTP 登录使用特定的证书。

+   `--auth-method <method>`：为`-a`选项定义授权方式，可以为`basic`，`digest`，`kerberos` 或 `ntlm`。

+   `-s <URL>`：定义要扫描的 URL。

+   `-p <proxy_url>`：使用 HTTP 或 HTTPS 代理。
